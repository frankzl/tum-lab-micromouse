\section{Hardware design}

In this section, the hardware design and implementation of the micromouse robot are described. First, the corresponding electrical circuit, known as scematic, is broken down to its components and thoroughly presented. In the next subsection, the actual components chosen for the hardware implementation are listed. The model for the final Printed Circuit Board (PCB) follows right after, where the chosen electrical components are placed in the computer model. Last, but not least, the protective casing for the micromouse is described.

\subsection{Schematic and Components Description}

The first step in the development of the hardware is the drawing of the electrical circuit. The realization of a moving micromouse demands for the combination of a variety of components connected to each other. Exactly this is described in the so called schematic of the circuit, which resembles a drawing on paper. 
The schematic of the micromouse can be seen in Fig. \ref{fig:schematic_overview}.

\begin{figure}[htb]
    \centering
    \includegraphics[width=1\textwidth]{figures/hardware/Schematic.PNG}
    \caption{Schematic overview of the micromouse}
    \label{fig:schematic_overview}
\end{figure}

This can look intimidating at first and definitely not readable in such a miniature picture. So, let's break it down to its components and describe its sub-circuits.

With the exception of the first subsection, the components will be presented from left to right and from top to bottom, so that the reader may always refer to the overview schematic to get a clear picture of a component's relation to the whole.

\FloatBarrier

\subsubsection{Microcontroller (MCU)}

The microcontroller (mcu) can be seen in Fig. \ref{fig:mcuL}.
Notice that the symbolic representation of the mcu, specifically when it comes to the location of its pins, doesn't correspond to the real model. For the purpose of the schematic, we don't really care about the real location of the pins. As will be seen later, this becomes of importance when placing the components on the board to be printed.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/MCU.PNG}
    \caption{The dsPIC33FJ64MC804 microcontroller}
    \label{fig:mcuL}
\end{figure}

\FloatBarrier

The assignment of mcu pins to components is presented in the Software Section and will not be repeated here. Please refer to that Section for understanding the functionality of its pin in our circuit.

Another point to notice about the pin connections is the convenient label feature that Eagle offers. Notice how some of the components are wired to the pins of the mcu, while other connections are represented as labels. Labels in the circuit are the equivalent of wires and greatly contribute to the readability and modularity of the schematic. As long as two wires anywhere in the circuit share the same label, they are connected.

A last comment has to be made about the pins of the mcu: The pins, as everything in our circuit, are very real components and therefore are subject to electrical limitations. This is a very important point to keep in mind, when driving any load, such as LEDs or a motor, but also when connecting input signals, such as sensors.
Specifically, in the section "Electrical Characteristics" in \cite{mcu}, we find maximum values for individual pins and for all utilized pins combined. These can be seen in Fig. \ref{fig:electrical}. These characteristics lead to some important design decisions, specifically named in later subsections.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/Electrical.PNG}
    \caption{Electrical limitations for the pins of the mcu}
    \label{fig:electrical}
\end{figure}

\FloatBarrier


\subsubsection{Votage Regulators}

The necessity for voltage regulators, which can be seen in Fig. \ref{fig:battery}, arises from the need for different voltages present in our system. 
Specifically, as found in \cite{mcu}, the mcu considers 3.3V as logical one and it is this voltage we need to provide to it (see VDD pins). The distance sensors used (taken from a previous micromouse model) need 5V. And yet the motors need 6V, as can be seen in \cite{motor}. 
Notice that we are using a battery of 9V. Therefore, we need a way to generate the required 3 different voltages.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/VoltageandCapacitors.PNG}
    \caption{The battery and voltage regulators}
    \label{fig:battery}
\end{figure}

\FloatBarrier

When it comes to the motor, we can regulate the voltage we feed it with, by regulating the maximum duty cycle of the PWM (explained in another Section). So, we provide it with a fraction of the available 9V.
For the distance sensors and the mcu, 2 voltage regulators are used in succession. They provide our components with steady voltage, necessary for functioning properly.

Now, notice the capacitors used in Fig. \ref{fig:battery}. Capacitors are used in the input and output of the voltage regulators. Additionally, a bunch of capacitors can be observed at the far right part of the sub-circuit.
All of these capacitors have both a special name and function. They are called decoupling capacitors and their role is to help in providing steady voltage. Specifically, they are always physically connected close to their corresponding component and should a temporary lack of electrons happen, they provide from their surplus, keeping the voltage steady.
The capacitors at the far right are only symbolically placed there in the circuit. In reality, they are connected between the pins of the mcu that connect to VDD (3.3V) and ground (GND).



\subsubsection{H-Bridge and Motors}

Describe the motors pins, with picture.
Describe the need for an H-bridge and its functionality, with picture.
Describe the escape diodes and their functionality.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/MotorsandHBridge.PNG}
    \caption{The motors and the H-bridge}
    \label{fig:motors}
\end{figure}

\FloatBarrier


\subsubsection{Extra Button}

Describe the need for an extra button and the pull-down resistor and value choice.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/Button.PNG}
    \caption{An extra button for input}
    \label{fig:button}
\end{figure}

\FloatBarrier


\subsubsection{Programmer}

Describe the usage of the programmer.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/Programmer.PNG}
    \caption{The programmer}
    \label{fig:programmer}
\end{figure}

\FloatBarrier


\subsubsection{Reset Button}

Describe the need for a reset button.
Describe the negative logic and pull-up resistor.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/MCLRandBatteryMeasurement.PNG}
    \caption{The reset button and the battery voltage measurement circuit}
    \label{fig:reset}
\end{figure}

\FloatBarrier


\subsubsection{Battery Measurement}

Describe the need for measuring the battery voltage level
and adjusting the PWM accordingly. 
Describe the concept of voltage divider and the values chosen.


\subsubsection{Universal Asynchronous Communication (UART)}


Describe the need for UART, to issue commands at will.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/UART.PNG}
    \caption{The UART module}
    \label{fig:uart}
\end{figure}

\FloatBarrier


\subsubsection{LEDs}

Describe the need for mechanical stability and the usage of LEDs. Say why we want to blink them.
Describe why transistors are needed and briefly the way they are connected.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/LEDs.PNG}
    \caption{The LEDs used for mechanical stability}
    \label{fig:leds}
\end{figure}

\FloatBarrier


\subsubsection{Oscillator}

Describe the choice for an external oscillator and the need for capacitors (mcu datasheet).

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/Oscillator.PNG}
    \caption{The external oscillator}
    \label{fig:oscillator}
\end{figure}

\FloatBarrier


\subsubsection{Distance Sensors}

Describe the need for sensors and the way they are connected.
Explain why we chose to have transistors there.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/DistanceSensors.PNG}
    \caption{The distance sensors}
    \label{fig:sensors}
\end{figure}

\FloatBarrier



\subsection{Components}

List the actual components we ordered.
No need to explain the values for resistors and capacitors.
Explain specific choices if needed.


\subsection{Printed Circuit Board (PCB)}

Comment on the restrictions of the PCB, dimensions and shape.
Explain the components' placement choice.
Describe the concept of 2 layers and via points.
Describe the concept of ground plane.
Comment on electrical noise, its sources and why it doesn't really matter in our case.

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/PCB.PNG}
    \caption{The PCB with both top and bottom tracks visible}
    \label{fig:pcb}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/PCB_Top.PNG}
    \caption{The PCB with only top layer tracks visible}
    \label{fig:top}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/PCB_Bottom.PNG}
    \caption{The PCB with only bottom layer tracks visible}
    \label{fig:bottom}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/PCB_Components.PNG}
    \caption{The PCB without tracks, only components visible}
    \label{fig:comp}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/hardware/PCB_Grounded.PNG}
    \caption{The PCB with the ground plane visible}
    \label{fig:gnd}
\end{figure}

\FloatBarrier

\subsection{Casing}

Present the need for casing.
Describe it.
Present necessary pictures.
Describe important calculations.






